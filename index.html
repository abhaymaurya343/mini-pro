<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R.R.I.M.T. Event Registration</title>
    <!-- 1. SUPABASE LIBRARY -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Configure Tailwind
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-50 to-indigo-50 dark:from-gray-900 dark:to-gray-800 min-h-screen font-sans text-gray-800 dark:text-gray-200">
    <div id="app"></div>

    <script>
        // --- 2. YOUR SUPABASE CONFIGURATION ---
        const SUPABASE_URL = 'https://vlmramucnwzjizikgabd.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZsbXJhbXVjbnd6aml6aWtnYWJkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4MjgwMTUsImV4cCI6MjA4MDQwNDAxNX0.Cpxz3TdcKlTXEG-cdKIxtv2ozrkZhnLQXSDLztY1ogY';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        const ADMIN_PASSWORD = 'rrimt2025';

        // State
        let state = {
            activeTab: 'events',
            adminSubTab: 'registrations',
            isAdminAuthenticated: false,
            adminPassword: '',
            events: [],
            registrations: [],
            newEvent: { name: '', date: '', time: '', venue: '', category: '' },
            editingEvent: null,
            formData: { name: '', email: '', phone: '', branch: '', year: '', event: '' },
            loading: true,
            isDarkMode: false 
        };

        // --- Core Data Functions (Connected to Supabase) ---

        function saveDarkModePreference() {
            localStorage.setItem('darkMode', JSON.stringify(state.isDarkMode));
        }

        function toggleDarkMode() {
            state.isDarkMode = !state.isDarkMode;
            document.body.classList.toggle('dark', state.isDarkMode);
            saveDarkModePreference();
            render(); 
        }

        async function loadData() {
            state.loading = true;
            render();
            try {
                // Fetch Events
                const { data: eventsData, error: eventError } = await supabase
                    .from('events')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (eventError) throw eventError;
                state.events = eventsData || [];

                // Fetch Registrations
                const { data: regData, error: regError } = await supabase
                    .from('registrations')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (regError) throw regError;
                state.registrations = regData || [];

                // Load Dark Mode
                const localDarkMode = localStorage.getItem('darkMode');
                state.isDarkMode = localDarkMode ? JSON.parse(localDarkMode) : false;
                
                if (state.isDarkMode) {
                    document.body.classList.add('dark');
                } else {
                    document.body.classList.remove('dark');
                }

            } catch (error) {
                console.error('Supabase Error:', error);
            } finally {
                state.loading = false;
                render();
            }
        }

        // --- Logic Functions ---

        async function handleSubmit() {
            const { name, email, phone, branch, year, event } = state.formData;
            
            if (!name || !email || !phone || !event) {
                alert('Please fill all required fields!');
                return;
            }

            const newReg = {
                id: Date.now(),
                name,
                email,
                phone,
                branch,
                year,
                event,
                registered_at: new Date().toLocaleString()
            };

            const { error } = await supabase.from('registrations').insert([newReg]);

            if (error) {
                console.error('Error submitting:', error);
                alert('Registration failed: ' + error.message);
                return;
            }

            state.registrations.unshift(newReg);
            state.formData = { name: '', email: '', phone: '', branch: '', year: '', event: '' };
            alert('Registration Successful! üéâ');
            state.activeTab = 'events';
            render();
        }

        function handleAdminLogin() {
            if (state.adminPassword === ADMIN_PASSWORD) {
                state.isAdminAuthenticated = true;
                state.adminPassword = '';
                render();
            } else {
                alert('Incorrect password!');
                state.adminPassword = '';
                render();
            }
        }

        async function handleAddEvent() {
            const { name, date, time, venue, category } = state.newEvent;
            
            if (!name || !date || !time || !venue || !category) {
                alert('Please fill all event details!');
                return;
            }

            const eventToAdd = {
                id: Date.now(),
                name,
                date,
                time,
                venue,
                category
            };

            const { error } = await supabase.from('events').insert([eventToAdd]);

            if (error) {
                console.error('Error adding event:', error);
                alert('Failed to add event: ' + error.message);
                return;
            }

            state.events.push(eventToAdd);
            state.newEvent = { name: '', date: '', time: '', venue: '', category: '' };
            alert('Event added successfully! üéâ');
            render();
        }

        async function handleUpdateEvent() {
            const { name, date, time, venue, category } = state.newEvent;
            
            if (!name || !date || !time || !venue || !category) {
                alert('Please fill all event details!');
                return;
            }

            const updates = { name, date, time, venue, category };

            const { error } = await supabase
                .from('events')
                .update(updates)
                .eq('id', state.editingEvent.id);

            if (error) {
                console.error('Error updating:', error);
                alert('Failed to update event.');
                return;
            }

            state.events = state.events.map(e => 
                e.id === state.editingEvent.id ? { ...e, ...updates } : e
            );
            
            state.editingEvent = null;
            state.newEvent = { name: '', date: '', time: '', venue: '', category: '' };
            alert('Event updated successfully! üéâ');
            render();
        }

        async function handleDeleteEvent(eventId) {
            if (!confirm('Are you sure you want to delete this event?')) return;

            const { error } = await supabase
                .from('events')
                .delete()
                .eq('id', eventId);

            if (error) {
                console.error('Error deleting:', error);
                alert('Failed to delete event.');
                return;
            }

            state.events = state.events.filter(e => e.id !== eventId);
            alert('Event deleted successfully!');
            render();
        }

        function handleEditEvent(event) {
            state.editingEvent = event;
            state.newEvent = {
                name: event.name,
                date: event.date,
                time: event.time,
                venue: event.venue,
                category: event.category
            };
            render();
        }

        function downloadRegistrations() {
            const csvContent = [
                ['Name', 'Email', 'Phone', 'Branch', 'Year', 'Event', 'Registered At'],
                ...state.registrations.map(r => [r.name, r.email, r.phone, r.branch, r.year, r.event, r.registered_at])
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'event-registrations.csv';
            a.click();
        }

        function getEventRegistrationCount(eventName) {
            return state.registrations.filter(r => r.event === eventName).length;
        }

        // --- Render Functions ---

        function render() {
            const app = document.getElementById('app');
            
            if (state.loading) {
                app.innerHTML = `
                    <div class="flex items-center justify-center min-h-screen">
                        <div class="text-center">
                            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"></div>
                            <p class="text-gray-600 dark:text-gray-400">Loading data from Database...</p>
                        </div>
                    </div>
                `;
                return;
            }

            app.innerHTML = `
                <div class="bg-indigo-700 text-white py-6 shadow-xl dark:bg-gray-800">
                    <div class="container mx-auto px-4 flex justify-between items-center">
                        <div>
                            <h1 class="text-3xl font-bold tracking-tight">R.R.I.M.T. Event Registration</h1>
                            <p class="text-indigo-200 mt-1 dark:text-gray-400">Lucknow, Uttar Pradesh</p>
                        </div>

                        <button onclick="window.toggleDarkMode()" class="w-10 h-10 rounded-full flex items-center justify-center bg-gray-100 text-gray-700 hover:bg-gray-200 shadow-md transition dark:bg-gray-700 dark:text-yellow-400 dark:hover:bg-gray-600">
                            <span class="text-xl">
                                ${state.isDarkMode ? '‚òÄÔ∏è' : 'üåô'}
                            </span>
                        </button>
                        </div>
                </div>

                <div class="container mx-auto px-4 mt-6">
                    <div class="bg-white rounded-lg shadow-xl p-2 dark:bg-gray-700">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                            <button onclick="changeTab('events')" class="
                                py-3 px-4 rounded-lg font-semibold transition duration-300 transform 
                                hover:scale-[1.02] active:scale-[0.98] 
                                ${state.activeTab === 'events' ? 'bg-indigo-600 text-white shadow-md dark:bg-indigo-500' : 'bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500'}
                            ">
                                üìÖ Events Schedule
                            </button>
                            <button onclick="changeTab('register')" class="
                                py-3 px-4 rounded-lg font-semibold transition duration-300 transform 
                                hover:scale-[1.02] active:scale-[0.98]
                                ${state.activeTab === 'register' ? 'bg-indigo-600 text-white shadow-md dark:bg-indigo-500' : 'bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500'}
                            ">
                                ‚úÖ Register Now
                            </button>
                            <button onclick="changeTab('admin')" class="
                                py-3 px-4 rounded-lg font-semibold transition duration-300 transform 
                                hover:scale-[1.02] active:scale-[0.98]
                                ${state.activeTab === 'admin' ? 'bg-green-600 text-white shadow-md dark:bg-green-500' : 'bg-green-100 text-green-700 hover:bg-green-200 dark:bg-gray-600 dark:text-green-300 dark:hover:bg-gray-500'}
                            ">
                                üë§ Admin Panel üîí
                            </button>
                        </div>
                    </div>
                </div>

                <div class="container mx-auto px-4 py-8 animate-fade-in">
                    ${renderContent()}
                </div>
            `;
        }

        function renderContent() {
            if (state.activeTab === 'events') {
                if (state.events.length === 0) {
                    return `
                        <div class="bg-white rounded-lg shadow-xl p-12 text-center dark:bg-gray-700">
                            <div class="text-6xl mb-4">üìÖ</div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2 dark:text-white">No Events Yet</h3>
                            <p class="text-gray-600 dark:text-gray-300">Events will appear here once the admin adds them.</p>
                        </div>
                    `;
                }
                
                return `
                    <div class="grid md:grid-cols-2 gap-6">
                        ${state.events.map(event => `
                            <div class="
                                bg-white rounded-xl shadow-lg p-6 transition duration-300 
                                hover:shadow-xl hover:translate-y-[-4px] 
                                dark:bg-gray-700 dark:hover:shadow-2xl dark:hover:shadow-indigo-500/20
                            ">
                                <div class="flex justify-between items-start mb-4">
                                    <h3 class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">${event.name}</h3>
                                    <span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-sm dark:bg-indigo-800 dark:text-indigo-200">${event.category}</span>
                                </div>
                                <div class="space-y-2 text-gray-600 dark:text-gray-300">
                                    <p>üìÖ ${event.date}</p>
                                    <p>‚è∞ ${event.time}</p>
                                    <p>üìç ${event.venue}</p>
                                </div>
                                <div class="mt-4 pt-4 border-t border-gray-100 dark:border-gray-600">
                                    <p class="text-sm text-gray-500 dark:text-gray-400"><strong>${getEventRegistrationCount(event.name)}</strong> students registered</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            if (state.activeTab === 'register') {
                return `
                    <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-xl p-8 dark:bg-gray-700">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 dark:text-white">Event Registration Form</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2 dark:text-gray-300">Full Name *</label>
                                <input type="text" id="name" value="${state.formData.name}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-600 dark:border-gray-500 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2 dark:text-gray-300">Email *</label>
                                <input type="email" id="email" value="${state.formData.email}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-600 dark:border-gray-500 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2 dark:text-gray-300">Phone Number *</label>
                                <input type="tel" id="phone" value="${state.formData.phone}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-600 dark:border-gray-500 dark:text-white">
                            </div>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2 dark:text-gray-300">Branch</label>
                                    <select id="branch" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-600 dark:border-gray-500 dark:text-white">
                                        <option value="">Select Branch</option>
                                        <option value="Biotechnology">Biotechnology</option>
                                        <option value="Mechanical">Mechanical Engineering</option>
                                        <option value="Electrical">Electrical Engineering</option>
                                        <option value="ECE">Electronics & Communication (ECE)</option>
                                        <option value="CE">Civil Engineering</option>
                                        <option value="CSE">Computer Science & Engineering (CSE)</option>
                                        <option value="CSE (AI/ML)">CSE (AI/ML)</option>
                                        <option value="IT">Information Technology (IT)</option>
                                        <option value="CSD">Computer Science & Design (CSD)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2 dark:text-gray-300">Year</label>
                                    <select id="year" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-600 dark:border-gray-500 dark:text-white">
                                        <option value="">Select Year</option>
                                        <option value="1st">1st Year</option>
                                        <option value="2nd">2nd Year</option>
                                        <option value="3rd">3rd Year</option>
                                        <option value="4th">4th Year</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2 dark:text-gray-300">Select Event *</label>
                                <select id="event" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-600 dark:border-gray-500 dark:text-white">
                                    <option value="">Choose an event</option>
                                    ${state.events.map(e => `<option value="${e.name}">${e.name} - ${e.date}</option>`).join('')}
                                </select>
                            </div>
                            <button onclick="submitRegistration()" class="
                                w-full bg-indigo-600 text-white py-3 rounded-lg font-medium transition duration-150 transform 
                                hover:bg-indigo-700 active:scale-95 
                                dark:bg-indigo-500 dark:hover:bg-indigo-600
                            ">Register Now</button>
                        </div>
                    </div>
                `;
            }

            if (state.activeTab === 'admin') {
                if (!state.isAdminAuthenticated) {
                    return `
                        <div class="max-w-md mx-auto bg-white rounded-xl shadow-xl p-8 dark:bg-gray-700">
                            <div class="text-center mb-6">
                                <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 dark:bg-green-800">
                                    <span class="text-4xl">üîí</span>
                                </div>
                                <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Admin Access Required</h2>
                                <p class="text-gray-600 mt-2 dark:text-gray-300">Enter password to access admin panel</p>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2 dark:text-gray-300">Password</label>
                                    <input type="password" id="adminPass" value="${state.adminPassword}" placeholder="Enter admin password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-600 dark:border-gray-500 dark:text-white" onkeypress="if(event.key==='Enter') loginAdmin()">
                                </div>
                                <button onclick="loginAdmin()" class="
                                    w-full bg-green-600 text-white py-3 rounded-lg font-medium transition duration-150 transform 
                                    hover:bg-green-700 active:scale-95
                                    dark:bg-green-500 dark:hover:bg-green-600
                                ">Login</button>
                                <p class="text-sm text-gray-500 text-center mt-4 dark:text-gray-400">üîí Only authorized personnel can access admin features</p>
                            </div>
                        </div>
                    `;
                }

                return `
                    <div>
                        <div class="bg-white rounded-xl shadow-xl p-6 mb-6 dark:bg-gray-700">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Admin Dashboard</h2>
                                <button onclick="logoutAdmin()" class="
                                    bg-gray-600 text-white px-4 py-2 rounded-lg transition duration-150 transform 
                                    hover:bg-gray-700 active:scale-95
                                    dark:bg-gray-800 dark:hover:bg-gray-900
                                ">Logout</button>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="changeAdminTab('registrations')" class="
                                    flex-1 py-2 px-4 rounded-lg font-medium transition duration-300 transform 
                                    hover:scale-[1.02] active:scale-[0.98] 
                                    ${state.adminSubTab === 'registrations' ? 'bg-green-600 text-white dark:bg-green-500' : 'bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500'}
                                ">
                                    üë• View Registrations
                                </button>
                                <button onclick="changeAdminTab('manageevents')" class="
                                    flex-1 py-2 px-4 rounded-lg font-medium transition duration-300 transform 
                                    hover:scale-[1.02] active:scale-[0.98]
                                    ${state.adminSubTab === 'manageevents' ? 'bg-orange-600 text-white dark:bg-orange-500' : 'bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500'}
                                ">
                                    ‚úèÔ∏è Manage Events
                                </button>
                            </div>
                        </div>
                        ${state.adminSubTab === 'registrations' ? renderRegistrations() : renderManageEvents()}
                    </div>
                `;
            }
        }

        function renderRegistrations() {
            return `
                <div class="bg-white rounded-xl shadow-xl p-6 dark:bg-gray-700">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white">All Registrations (${state.registrations.length})</h3>
                        ${state.registrations.length > 0 ? '<button onclick="downloadRegistrations()" class="flex items-center bg-green-600 text-white px-4 py-2 rounded-lg transition duration-150 transform hover:bg-green-700 active:scale-95 dark:bg-green-500 dark:hover:bg-green-600">üì• Download CSV</button>' : ''}
                    </div>
                    ${state.registrations.length === 0 ? '<p class="text-center text-gray-500 py-12 dark:text-gray-400">No registrations yet.</p>' : `
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 dark:bg-gray-800">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Name</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Email</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Phone</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Branch</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Event</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300">Registered</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200 dark:divide-gray-600">
                                    ${state.registrations.map(r => `
                                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-600 transition duration-150">
                                            <td class="px-4 py-3 text-sm dark:text-gray-200">${r.name}</td>
                                            <td class="px-4 py-3 text-sm dark:text-gray-200">${r.email}</td>
                                            <td class="px-4 py-3 text-sm dark:text-gray-200">${r.phone}</td>
                                            <td class="px-4 py-3 text-sm dark:text-gray-200">${r.branch} ${r.year}</td>
                                            <td class="px-4 py-3 text-sm font-medium text-indigo-600 dark:text-indigo-400">${r.event}</td>
                                            <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-300">${r.registered_at}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `}
                </div>
            `;
        }

        function renderManageEvents() {
            return `
                <div>
                    <div class="max-w-xl mx-auto bg-white rounded-xl shadow-xl p-8 mb-6 dark:bg-gray-700">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 dark:text-white">${state.editingEvent ? 'Edit Event' : 'Add New Event'}</h3>
                        ${state.editingEvent ? '<div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 dark:bg-blue-800 dark:border-blue-400"><p class="text-blue-800 text-sm dark:text-blue-100">‚úèÔ∏è Editing: <strong>' + state.editingEvent.name + '</strong></p></div>' : ''}
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2 dark:text-gray-300">Event Name *</label>
                                <input type="text" id="eventName" value="${state.newEvent.name}" placeholder="e.g., Annual Day 2025" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent dark:bg-gray-600 dark:border-gray-500 dark:text-white">
                            </div>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2 dark:text-gray-300">Date *</label>
                                    <input type="date" id="eventDate" value="${state.newEvent.date}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent dark:bg-gray-600 dark:border-gray-500 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2 dark:text-gray-300">Time *</label>
                                    <input type="time" id="eventTime" value="${state.newEvent.time}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent dark:bg-gray-600 dark:border-gray-500 dark:text-white">
                                </div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2 dark:text-gray-300">Venue *</label>
                                <input type="text" id="eventVenue" value="${state.newEvent.venue}" placeholder="e.g., Main Auditorium" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent dark:bg-gray-600 dark:border-gray-500 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2 dark:text-gray-300">Category *</label>
                                <select id="eventCategory" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent dark:bg-gray-600 dark:border-gray-500 dark:text-white">
                                    <option value="">Select Category</option>
                                    <option value="Technical" ${state.newEvent.category === 'Technical' ? 'selected' : ''}>Technical</option>
                                    <option value="Cultural" ${state.newEvent.category === 'Cultural' ? 'selected' : ''}>Cultural</option>
                                    <option value="Sports" ${state.newEvent.category === 'Sports' ? 'selected' : ''}>Sports</option>
                                    <option value="Workshop" ${state.newEvent.category === 'Workshop' ? 'selected' : ''}>Workshop</option>
                                    <option value="Seminar" ${state.newEvent.category === 'Seminar' ? 'selected' : ''}>Seminar</option>
                                    <option value="Other" ${state.newEvent.category === 'Other' ? 'selected' : ''}>Other</option>
                                </select>
                            </div>
                            ${state.editingEvent ? `
                                <div class="flex gap-3">
                                    <button onclick="updateEvent()" class="
                                        flex-1 bg-blue-600 text-white py-3 rounded-lg font-medium transition duration-150 transform 
                                        hover:bg-blue-700 active:scale-95
                                        dark:bg-blue-500 dark:hover:bg-blue-600
                                    ">Update Event</button>
                                    <button onclick="cancelEdit()" class="
                                        flex-1 bg-gray-500 text-white py-3 rounded-lg font-medium transition duration-150 transform 
                                        hover:bg-gray-500 active:scale-95
                                        dark:bg-gray-800 dark:hover:bg-gray-900
                                    ">Cancel</button>
                                </div>
                            ` : `
                                <button onclick="addEvent()" class="
                                    w-full bg-green-600 text-white py-3 rounded-lg font-medium transition duration-150 transform 
                                    hover:bg-green-700 active:scale-95
                                    dark:bg-green-500 dark:hover:bg-green-600
                                ">Add Event</button>
                            `}
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-xl p-6 dark:bg-gray-700">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 dark:text-white">Existing Events (${state.events.length})</h3>
                        ${state.events.length === 0 ? '<p class="text-center text-gray-500 py-8 dark:text-gray-400">No events added yet. Add your first event above!</p>' : `
                            <div class="space-y-3">
                                ${state.events.map(event => `
                                    <div class="
                                        flex justify-between items-center p-4 bg-gray-50 rounded-lg transition duration-150 
                                        hover:bg-gray-100 hover:shadow-md 
                                        dark:bg-gray-600 dark:hover:bg-gray-500
                                    ">
                                        <div>
                                            <h4 class="font-semibold text-gray-800 dark:text-white">${event.name}</h4>
                                            <p class="text-sm text-gray-600 dark:text-gray-300">${event.date} at ${event.time} | ${event.venue}</p>
                                            <span class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded mt-1 inline-block dark:bg-indigo-800 dark:text-indigo-200">${event.category}</span>
                                        </div>
                                        <div class="flex gap-2">
                                            <button onclick="editEvent(${event.id})" class="bg-blue-500 text-white px-4 py-2 rounded-lg transition duration-150 transform hover:bg-blue-600 active:scale-95 text-sm dark:bg-blue-400 dark:hover:bg-blue-500">‚úèÔ∏è Edit</button>
                                            <button onclick="deleteEvent(${event.id})" class="bg-red-500 text-white px-4 py-2 rounded-lg transition duration-150 transform hover:bg-red-600 active:scale-95 text-sm dark:bg-red-600 dark:hover:bg-red-700">üóëÔ∏è Delete</button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        // --- Global functions (Exposed to HTML) ---
        window.changeTab = (tab) => { state.activeTab = tab; render(); };
        window.changeAdminTab = (tab) => { state.adminSubTab = tab; render(); };
        window.loginAdmin = () => { state.adminPassword = document.getElementById('adminPass').value; handleAdminLogin(); };
        window.logoutAdmin = () => { state.isAdminAuthenticated = false; state.activeTab = 'events'; state.adminSubTab = 'registrations'; render(); };
        window.toggleDarkMode = toggleDarkMode; 
        window.submitRegistration = () => {
            state.formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                branch: document.getElementById('branch').value,
                year: document.getElementById('year').value,
                event: document.getElementById('event').value
            };
            handleSubmit();
        };
        window.addEvent = () => {
            state.newEvent = {
                name: document.getElementById('eventName').value,
                date: document.getElementById('eventDate').value,
                time: document.getElementById('eventTime').value,
                venue: document.getElementById('eventVenue').value,
                category: document.getElementById('eventCategory').value
            };
            handleAddEvent();
        };
        window.updateEvent = () => {
            state.newEvent = {
                name: document.getElementById('eventName').value,
                date: document.getElementById('eventDate').value,
                time: document.getElementById('eventTime').value,
                venue: document.getElementById('eventVenue').value,
                category: document.getElementById('eventCategory').value
            };
            handleUpdateEvent();
        };
        window.editEvent = (id) => {
            const event = state.events.find(e => e.id === id);
            if (event) handleEditEvent(event);
        };
        window.deleteEvent = (id) => handleDeleteEvent(id);
        window.cancelEdit = () => {
            state.editingEvent = null;
            state.newEvent = { name: '', date: '', time: '', venue: '', category: '' };
            render();
        };
        window.downloadRegistrations = downloadRegistrations;

        // Initialize
        loadData();
    </script>
</body>
</html>